# SPDX-License-Identifier: MIT                                                
# Copyright (c) 2021 GPUFORT Advanced Micro Devices, Inc. All rights reserved.
class Acc2Omp(AccBackendBase):
    def transform(self,joinedLines,joinedStatements,statementsFullyCoverLines):
        snippet = joinedStatements
        try:
           def repl(parseResult):
                return parseResult.ompFStr(), True
           result,_ = utils.pyparsingutils.replaceFirst(snippet,\
                    translator.acc_simple_directive,\
                    repl)
           return result, True 
        except Exception as e:
           print("failed: "+snippet) # TODO error handling
           raise e
           return "", False 

class AccLoopKernel2Omp(AccBackendBase):
    def transform(self,joinedLines,joinedStatements,statementsFullyCoverLines):
        if statementsFullyCoverLines:
            snippet = joinedLines
        else:
            snippet = joinedStatements
        try:
           parseResult = translator.loop_kernel.parseString(snippet)[0]
           return parseResult.ompFStr(snippet), True 
        except Exception as e:
           print("failed: "+snippet) # TODO error handling
           raise e
           return "", False 

registerAccBackend("omp",Acc2Omp,AccLoopKernel2Omp,None)