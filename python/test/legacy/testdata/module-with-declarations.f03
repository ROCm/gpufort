module test

  contains

    INTEGER::current_size=0
    COMPLEX(DP),ALLOCATABLE::dev_space_fftparallel(:)
    COMPLEX(DP),ALLOCATABLE::dev_space_scatter_dblbuffer(:)
    COMPLEX(DP),ALLOCATABLE::pin_space_scatter_dblbuffer(:)
    COMPLEX(DP),ALLOCATABLE::pin_space_scatter_in(:)
    COMPLEX(DP),ALLOCATABLE::pin_space_scatter_out(:)
    TYPE(fft_type_descriptor),INTENT(in)::desc
    INTEGER,OPTIONAL,INTENT(IN)::howmany
    INTEGER::howmany_
    INTEGER::info
    CHARACTER(LEN=*),INTENT(IN)::calling_routine,message
    INTEGER,INTENT(IN)::ierr
    CHARACTER(LEN=6)::cerr
    INTEGER::info
    TYPE(fft_type_descriptor),INTENT(IN)::dfft
    CHARACTER(LEN=*),INTENT(IN)::fft_kind
    COMPLEX(DP)::f(:)
    INTEGER,OPTIONAL,INTENT(IN)::howmany
    INTEGER::howmany_=1
    CHARACTER(LEN=12)::clock_label
    TYPE(fft_type_descriptor),INTENT(IN)::dfft
    CHARACTER(LEN=*),INTENT(IN)::fft_kind
    COMPLEX(DP)::f(:)
    INTEGER,OPTIONAL,INTENT(IN)::howmany
    INTEGER::howmany_=1
    CHARACTER(LEN=12)::clock_label
    TYPE(fft_box_descriptor),INTENT(IN)::dfft
    INTEGER,INTENT(IN)::ia
    COMPLEX(DP)::f(:)
    TYPE(fft_type_descriptor),INTENT(IN)::dfft
    CHARACTER(LEN=*),INTENT(IN)::fft_kind
    COMPLEX(DP),DEVICE::f_d(:)
    INTEGER,OPTIONAL,INTENT(IN)::howmany
    INTEGER(kind=cuda_stream_kind),OPTIONAL,INTENT(IN)::stream
    INTEGER::howmany_=1
    INTEGER(kind=cuda_stream_kind)::stream_=0
    CHARACTER(LEN=12)::clock_label
    TYPE(fft_type_descriptor),INTENT(IN)::dfft
    CHARACTER(LEN=*),INTENT(IN)::fft_kind
    COMPLEX(DP),DEVICE::f_d(:)
    INTEGER,OPTIONAL,INTENT(IN)::howmany
    INTEGER(kind=cuda_stream_kind),OPTIONAL,INTENT(IN)::stream
    INTEGER::howmany_=1
    INTEGER(kind=cuda_stream_kind)::stream_=0
    CHARACTER(LEN=12)::clock_label
    TYPE(fft_type_descriptor),INTENT(inout)::dfft
    REAL(DP),INTENT(IN)::g(:,:)
    REAL(DP),INTENT(IN)::at(:,:)
    INTEGER,OPTIONAL,INTENT(OUT)::mill(:,:)
    INTEGER::ng,n1,n2,n3
    TYPE(fft_type_descriptor),INTENT(in)::desc
    INTEGER,INTENT(IN)::ispin
    LOGICAL,INTENT(IN)::noncolin,domag
    REAL(DP),INTENT(INOUT)::tg_rho(:)
    REAL(DP),INTENT(INOUT)::tg_rho_nc(:,:)
    REAL(DP),INTENT(OUT)::rhos(:,:)
    INTEGER::ierr,ioff,idx,ir3,ir,ipol,ioff_tg,nxyp,npol_
    TYPE(fft_type_descriptor),INTENT(in)::desc
    INTEGER,INTENT(IN)::ispin
    REAL(DP),INTENT(INOUT)::tmp_rhos(:)
    REAL(DP),INTENT(OUT)::rhos(:,:)
    INTEGER::ierr,ioff,idx,ir3,nxyp,ioff_tg
    TYPE(fft_type_descriptor),INTENT(in)::desc
    REAL(DP),INTENT(INOUT)::tmp_rhos(:,:)
    REAL(DP),INTENT(OUT)::rhos(:,:)
    INTEGER::ierr,from,ir3,ioff,nxyp,ioff_tg
    TYPE(fft_type_descriptor),INTENT(in)::desc
    COMPLEX(DP),INTENT(INOUT)::tmp_rhos(:)
    COMPLEX(DP),INTENT(OUT)::rhos(:)
    INTEGER::ierr,from,ir3,ioff,nxyp,ioff_tg
    TYPE(fft_type_descriptor),INTENT(in)::desc
    COMPLEX(DP),INTENT(INOUT)::tmp_rhos(:,:)
    COMPLEX(DP),INTENT(OUT)::rhos(:,:)
    INTEGER::ierr,from,ir3,ioff,nxyp,ioff_tg
    TYPE(fft_type_descriptor),INTENT(in)::desc
    INTEGER,INTENT(OUT)::right_nnr
    TYPE(fft_type_descriptor),INTENT(in)::desc
    INTEGER,INTENT(OUT)::val
    TYPE(fft_type_descriptor),INTENT(in)::desc
    INTEGER,INTENT(OUT)::val
    TYPE(fft_type_descriptor),INTENT(in)::desc
    INTEGER,INTENT(OUT)::val
    INTEGER::fftx_ntgrp
    TYPE(fft_type_descriptor),INTENT(in)::desc
    INTEGER::fftx_tgpe
    TYPE(fft_type_descriptor),INTENT(in)::desc
    INTEGER::fftx_tgcomm
    TYPE(fft_type_descriptor),INTENT(in)::desc
    TYPE(fft_type_descriptor),INTENT(in)::desc
    REAL(DP),INTENT(INOUT)::r(:,:)
    REAL(DP),INTENT(IN)::f(:)
    INTEGER::nspin,ir
    TYPE(fft_type_descriptor),INTENT(in)::desc
    complex(DP),INTENT(OUT)::psi(:)
    complex(DP),INTENT(IN)::c(:)
    complex(DP),OPTIONAL,INTENT(IN)::ca(:)
    complex(DP),parameter::ci=(0.0d0,1.0d0)
    integer::ig
    TYPE(fft_type_descriptor),INTENT(in)::desc
    complex(DP),INTENT(OUT)::psi(:)
    complex(DP),INTENT(IN)::c(:)
    INTEGER,INTENT(IN)::igk(:),ngk
    integer::ig
    TYPE(fft_type_descriptor),INTENT(in)::desc
    complex(DP),INTENT(OUT)::psi(:)
    complex(DP),INTENT(IN)::c(:)
    complex(DP),OPTIONAL,INTENT(IN)::ca(:)
    complex(DP),parameter::ci=(0.0d0,1.0d0)
    integer::ig
    TYPE(fft_type_descriptor),INTENT(in)::desc
    complex(DP),INTENT(INOUT)::vout1(:)
    complex(DP),OPTIONAL,INTENT(INOUT)::vout2(:)
    complex(DP),INTENT(IN)::vin(:)
    COMPLEX(DP)::fp,fm
    INTEGER::ig
    TYPE(fft_type_descriptor),INTENT(in)::desc
    complex(DP),INTENT(OUT)::vout1(:)
    complex(DP),OPTIONAL,INTENT(OUT)::vout2(:)
    complex(DP),INTENT(IN)::vin(:)
    COMPLEX(DP)::fp,fm
    INTEGER::ig
    TYPE(fft_type_descriptor),INTENT(in)::desc
    complex(DP),INTENT(OUT)::vout1(:)
    complex(DP),OPTIONAL,INTENT(OUT)::vout2(:)
    complex(DP),INTENT(IN)::vin(:)
    COMPLEX(DP)::fp,fm
    INTEGER::ig
    TYPE(fft_type_descriptor),INTENT(in)::desc
    complex(DP),INTENT(OUT)::psis(:)
    complex(DP),INTENT(INOUT)::c_bgrp(:,:)
    INTEGER,INTENT(IN)::i,nbsp_bgrp
    INTEGER::eig_offset,eig_index,right_nnr
    INTEGER,INTENT(IN)::unit
    TYPE(fft_type_descriptor),INTENT(in)::desc
    INTEGER::i,j,nr3l
    CHARACTER(LEN=*),INTENT(IN)::fft_kind
    TYPE(fft_type_descriptor),INTENT(IN)::dfft
    INTEGER,OPTIONAL,INTENT(IN)::howmany
    COMPLEX(DP)::f(:)
    INTEGER,INTENT(IN)::ia
    TYPE(fft_box_descriptor),INTENT(IN)::dfft
    COMPLEX(DP)::f(:)
    CHARACTER(LEN=*),INTENT(IN)::grid_type
    TYPE(fft_type_descriptor),INTENT(IN)::dfft
    INTEGER,OPTIONAL,INTENT(IN)::howmany
    INTEGER(kind=cuda_stream_kind),OPTIONAL,INTENT(IN)::stream
    COMPLEX(DP),DEVICE::f_d(:)
    CHARACTER(LEN=*),INTENT(IN)::fft_kind
    TYPE(fft_type_descriptor),INTENT(IN)::dfft
    INTEGER,OPTIONAL,INTENT(IN)::howmany
    COMPLEX(DP)::f(:)
    CHARACTER(LEN=*),INTENT(IN)::grid_type
    TYPE(fft_type_descriptor),INTENT(IN)::dfft
    INTEGER,OPTIONAL,INTENT(IN)::howmany
    INTEGER(kind=cuda_stream_kind),OPTIONAL,INTENT(IN)::stream
    COMPLEX(DP),DEVICE::f_d(:)
    TYPE(fft_type_descriptor),INTENT(IN)::dfft_in,dfft_out
    REAL(DP),INTENT(IN)::v_in(:)
    REAL(DP),INTENT(OUT)::v_out(:)
    TYPE(fft_type_descriptor),INTENT(IN)::dfft_in,dfft_out
    COMPLEX(DP),INTENT(IN)::v_in(:)
    COMPLEX(DP),INTENT(OUT)::v_out(:)
    TYPE(fft_type_descriptor),INTENT(IN)::dfft_in,dfft_out
    REAL(DP),INTENT(IN)::v_in(:)
    REAL(DP),INTENT(OUT)::v_out(:)
    INTEGER::ngm
    COMPLEX(DP),ALLOCATABLE::aux_in(:),aux_out(:)
    TYPE(fft_type_descriptor),INTENT(IN)::dfft_in,dfft_out
    COMPLEX(DP),INTENT(IN)::v_in(:)
    COMPLEX(DP),INTENT(OUT)::v_out(:)
    INTEGER::ngm
    COMPLEX(DP),ALLOCATABLE::aux_in(:)
    TYPE(fft_type_descriptor),INTENT(in)::dfft
    COMPLEX(DP),INTENT(inout)::f(:)
    INTEGER,INTENT(in)::isgn
    INTEGER::n1,n2,n3,nx1,nx2,nx3
    INTEGER::nnr_
    INTEGER::nsticks_x,nsticks_y,nsticks_z
    COMPLEX(DP),ALLOCATABLE::aux(:)
    INTEGER::i
    TYPE(fft_type_descriptor),INTENT(in)::dfft
    COMPLEX(DP),DEVICE,INTENT(inout)::f_d(:)
    INTEGER,INTENT(in)::isgn
    INTEGER::n1,n2,n3,nx1,nx2,nx3
    INTEGER::nnr_
    INTEGER::nsticks_x,nsticks_y,nsticks_z
    INTEGER::ierr,i
    INTEGER(kind=cuda_stream_kind)::stream=0
    TYPE(fft_type_descriptor),INTENT(in)::dfft
    COMPLEX(DP),DEVICE,INTENT(inout)::f_d(:)
    INTEGER,INTENT(in)::isgn
    INTEGER,INTENT(in)::howmany
    INTEGER::n1,n2,n3,nx1,nx2,nx3
    INTEGER::nnr_
    INTEGER::nsticks_x,nsticks_y,nsticks_z
    INTEGER::nsticks_zx
    INTEGER::ierr,i,j
    INTEGER::nstreams
    INTEGER(kind=cuda_stream_kind)::stream=0
    TYPE(fft_type_descriptor),INTENT(IN)::dfft
    INTEGER,INTENT(IN)::i,j,k
    COMPLEX(DP),INTENT(IN)::f(:)
    INTEGER::kk,ii,jj,ip,ierr
    COMPLEX(DP)::f_aux
    TYPE(fft_type_descriptor),INTENT(IN)::dfft
    INTEGER,INTENT(IN)::i,j,k
    COMPLEX(DP),INTENT(IN)::f_in
    COMPLEX(DP),INTENT(INOUT)::f(:)
    INTEGER::kk,ii,jj,ip,ierr
    INTEGER,INTENT(IN)::i,j,k
    COMPLEX(DP),INTENT(IN)::f(:)
    TYPE(fft_type_descriptor),INTENT(IN)::dfft
    INTEGER::ii,jj,ip,ierr
    COMPLEX(DP)::f_aux
    COMPLEX(DP),INTENT(IN)::f_in
    INTEGER,INTENT(IN)::i,j,k
    COMPLEX(DP),INTENT(INOUT)::f(:)
    TYPE(fft_type_descriptor),INTENT(IN)::dfft
    INTEGER::ii,jj
    COMPLEX(DP),INTENT(inout)::f(:)
    TYPE(fft_type_descriptor),INTENT(in)::dfft
    INTEGER,INTENT(in)::isgn
    INTEGER::me_p
    INTEGER::n1,n2,n3,nx1,nx2,nx3
    COMPLEX(DP),ALLOCATABLE::aux(:)
    INTEGER::planes(dfft%nr1x)
    INTEGER,INTENT(in)::iopt
    INTEGER,INTENT(in)::iopt
    TYPE(fft_type_descriptor),INTENT(in)::dfft
    COMPLEX(DP),DEVICE,INTENT(inout)::f_d(dfft%nnr)
    INTEGER,INTENT(in)::isgn
    INTEGER::me_p,istat
    INTEGER::n1,n2,n3,nx1,nx2,nx3
    COMPLEX(DP),ALLOCATABLE::yf(:)
    INTEGER::planes(dfft%nr1x)
    INTEGER(kind=cuda_stream_kind)::stream=0
    INTEGER,INTENT(in)::iopt
    INTEGER,INTENT(in)::iopt
    TYPE(fft_type_descriptor),INTENT(in)::dfft
    INTEGER,INTENT(in)::isgn
    INTEGER,INTENT(in)::batchsize
    COMPLEX(DP),DEVICE,INTENT(inout)::f_d(batchsize*dfft%nnr)
    INTEGER::me_p,istat,i,j,currsize
    INTEGER::n1,n2,n3,nx1,nx2,nx3,ncpx,nppx,proc
    COMPLEX(DP),ALLOCATABLE::yf(:)
    INTEGER::planes(dfft%nr1x)
    INTEGER::sticks(dfft%nproc)
    INTEGER(kind=cuda_stream_kind)::stream=0
    INTEGER,PARAMETER::MPI_COMM_NULL=0
    INTEGER,PARAMETER::ndims=10
    INTEGER,PARAMETER::nfftx=2049
    INTEGER,PARAMETER::DP=selected_real_kind(14,200)
    INTEGER,PARAMETER::stdout=6
    REAL(DP),PARAMETER::eps8=1.0E-8_DP
    INTEGER,INTENT(IN)::isign
    INTEGER,INTENT(IN)::nsl,nz,ldz
    COMPLEX(DP)::c(:),cout(:)
    REAL(DP)::tscale
    INTEGER::i,err,idir,ip,void
    INTEGER,SAVE::zdims(3,ndims)=-1
    INTEGER,SAVE::icurrent=1
    LOGICAL::found
    INTEGER::tid
    INTEGER::offset,ldz_t
    INTEGER::omp_get_max_threads
    INTEGER,PARAMETER::ltabl=3*nfftx+100
    INTEGER::INFO
    COMPLEX(DP),SAVE::fw_tablez(ltabl,ndims)
    COMPLEX(DP),SAVE::bw_tablez(ltabl,ndims)
    INTEGER,INTENT(IN)::isign,ldx,ldy,nx,ny,nzl
    INTEGER,OPTIONAL,INTENT(IN)::pl2ix(:)
    COMPLEX(DP)::r(:)
    INTEGER::i,k,j,err,idir,ip,kk,void
    REAL(DP)::tscale
    INTEGER,SAVE::icurrent=1
    INTEGER,SAVE::dims(4,ndims)=-1
    LOGICAL::dofft(nfftx),found
    INTEGER,PARAMETER::stdout=6
    INTEGER::offset
    INTEGER::nx_t,ny_t,nzl_t,ldx_t,ldy_t
    INTEGER::itid,mytid,ntids
    INTEGER::omp_get_thread_num,omp_get_num_threads,omp_get_max_threads
    INTEGER,PARAMETER::ltabl=3*nfftx+100
    INTEGER::INFO
    COMPLEX(DP),SAVE::fw_tablex(ltabl,ndims),bw_tablex(ltabl,ndims)
    COMPLEX(DP),SAVE::fw_tabley(ltabl,ndims),bw_tabley(ltabl,ndims)
    INTEGER,INTENT(IN)::nx,ny,nz,ldx,ldy,ldz,howmany,isign
    COMPLEX(DP)::f(:)
    INTEGER::i,k,j,err,idir,ip
    REAL(DP)::tscale
    INTEGER,SAVE::icurrent=1
    INTEGER,SAVE::dims(3,ndims)=-1
    INTEGER,PARAMETER::ltabl=4*nfftx+300
    INTEGER::INFO
    COMPLEX(DP),SAVE::fw_table(ltabl,ndims)
    COMPLEX(DP),SAVE::bw_table(ltabl,ndims)
    TYPE(C_PTR),save::fw_plan(ndims)=C_NULL_PTR
    TYPE(C_PTR),save::bw_plan(ndims)=C_NULL_PTR
    integer::nx,ny,nz,ldx,ldy,ldz,howmany,isign
    complex(DP)::f(ldx*ldy*ldz)
    integer::do_fft_y(:),do_fft_z(:)
    integer::m,incx1,incx2
    INTEGER::i,k,j,err,idir,ip,ii,jj
    REAL(DP)::tscale
    INTEGER,SAVE::icurrent=1
    INTEGER,SAVE::dims(3,ndims)=-1
    INTEGER,PARAMETER::ltabl=3*nfftx+100
    INTEGER::INFO
    COMPLEX(DP),SAVE::fw_table(ltabl,3,ndims)
    COMPLEX(DP),SAVE::bw_table(ltabl,3,ndims)
    TYPE(DFTI_DESCRIPTOR),POINTER::desc
    INTEGER,INTENT(IN)::isign
    INTEGER,INTENT(IN)::nsl,nz,ldz
    COMPLEX(DP)::c(:),cout(:)
    REAL(DP)::tscale
    INTEGER::i,err,idir,ip,void
    INTEGER,SAVE::zdims(3,ndims)=-1
    INTEGER,SAVE::icurrent=1
    LOGICAL::found
    INTEGER::tid
    INTEGER::offset,ldz_t
    INTEGER::omp_get_max_threads
    TYPE(DFTI_DESCRIPTOR_ARRAY),SAVE::hand(ndims)
    LOGICAL,SAVE::dfti_first=.TRUE.
    INTEGER::dfti_status=0
    INTEGER,INTENT(IN)::isign,ldx,ldy,nx,ny,nzl
    INTEGER,OPTIONAL,INTENT(IN)::pl2ix(:)
    COMPLEX(DP)::r(:)
    INTEGER::i,k,j,err,idir,ip,kk,void
    REAL(DP)::tscale
    INTEGER,SAVE::icurrent=1
    INTEGER,SAVE::dims(4,ndims)=-1
    LOGICAL::dofft(nfftx),found
    INTEGER,PARAMETER::stdout=6
    INTEGER::offset
    INTEGER::nx_t,ny_t,nzl_t,ldx_t,ldy_t
    INTEGER::itid,mytid,ntids
    INTEGER::omp_get_thread_num,omp_get_num_threads,omp_get_max_threads
    TYPE(DFTI_DESCRIPTOR_ARRAY),SAVE::hand(ndims)
    LOGICAL,SAVE::dfti_first=.TRUE.
    INTEGER::dfti_status=0
    INTEGER,INTENT(IN)::nx,ny,nz,ldx,ldy,ldz,howmany,isign
    COMPLEX(DP)::f(:)
    INTEGER::i,k,j,err,idir,ip
    REAL(DP)::tscale
    INTEGER,SAVE::icurrent=1
    INTEGER,SAVE::dims(4,ndims)=-1
    TYPE(DFTI_DESCRIPTOR_ARRAY),SAVE::hand(ndims)
    LOGICAL,SAVE::dfti_first=.TRUE.
    INTEGER::dfti_status=0
    integer::nx,ny,nz,ldx,ldy,ldz,isign,howmany
    complex(DP)::f(ldx*ldy*ldz)
    integer::do_fft_y(:),do_fft_z(:)
    INTEGER,PARAMETER::lwork=20000+(2*nfftx+256)*64+3*nfftx
    REAL(DP)::work(lwork)
    INTEGER,INTENT(IN)::isign
    INTEGER,INTENT(IN)::nsl,nz,ldz
    COMPLEX(DP)::c(:),cout(:)
    REAL(DP)::tscale
    INTEGER::i,err,idir,ip,void
    INTEGER,SAVE::zdims(3,ndims)=-1
    INTEGER,SAVE::icurrent=1
    LOGICAL::done
    INTEGER::tid
    INTEGER::offset,ldz_t
    INTEGER::omp_get_max_threads
    INTEGER,PARAMETER::ltabl=20000+3*nfftx
    REAL(DP),SAVE::fw_tablez(ltabl,ndims)
    REAL(DP),SAVE::bw_tablez(ltabl,ndims)
    INTEGER,INTENT(IN)::isign,ldx,ldy,nx,ny,nzl
    INTEGER,OPTIONAL,INTENT(IN)::pl2ix(:)
    COMPLEX(DP)::r(:)
    INTEGER::i,k,j,err,idir,ip,kk,void
    REAL(DP)::tscale
    INTEGER,SAVE::icurrent=1
    INTEGER,SAVE::dims(4,ndims)=-1
    LOGICAL::dofft(nfftx),done
    INTEGER,PARAMETER::stdout=6
    INTEGER::offset
    INTEGER::nx_t,ny_t,nzl_t,ldx_t,ldy_t
    INTEGER::itid,mytid,ntids
    INTEGER::omp_get_thread_num,omp_get_num_threads,omp_get_max_threads
    INTEGER,PARAMETER::ltabl=20000+3*nfftx
    REAL(DP),SAVE::fw_tablex(ltabl,ndims),fw_tabley(ltabl,ndims)
    REAL(DP),SAVE::bw_tablex(ltabl,ndims),bw_tabley(ltabl,ndims)
    INTEGER,INTENT(IN)::nx,ny,nz,ldx,ldy,ldz,howmany,isign
    COMPLEX(DP)::f(:)
    INTEGER::i,k,j,err,idir,ip
    REAL(DP)::tscale
    INTEGER,SAVE::icurrent=1
    INTEGER,SAVE::dims(3,ndims)=-1
    integer::nx,ny,nz,ldx,ldy,ldz,howmany,isign
    complex(DP)::f(ldx*ldy*ldz)
    integer::do_fft_y(:),do_fft_z(:)
    integer::m,incx1,incx2
    INTEGER::i,k,j,err,idir,ip,ii,jj
    REAL(DP)::tscale
    INTEGER,SAVE::icurrent=1
    INTEGER,SAVE::dims(3,ndims)=-1
    INTEGER,PARAMETER::ltabl=20000+3*nfftx
    REAL(DP),SAVE::fw_table(ltabl,3,ndims)
    REAL(DP),SAVE::bw_table(ltabl,3,ndims)
    INTEGER,INTENT(IN)::isign
    INTEGER,INTENT(IN)::nsl,nz,ldz
    COMPLEX(DP)::c(:),cout(:)
    REAL(DP)::tscale
    INTEGER::i,err,idir,ip,void
    INTEGER,SAVE::zdims(3,ndims)=-1
    INTEGER,SAVE::icurrent=1
    LOGICAL::found
    INTEGER::tid
    INTEGER::offset,ldz_t
    INTEGER::omp_get_max_threads
    TYPE(C_PTR),SAVE::fw_planz(ndims)=C_NULL_PTR
    TYPE(C_PTR),SAVE::bw_planz(ndims)=C_NULL_PTR
    INTEGER,INTENT(IN)::isign,ldx,ldy,nx,ny,nzl
    INTEGER,OPTIONAL,INTENT(IN)::pl2ix(:)
    COMPLEX(DP)::r(:)
    INTEGER::i,k,j,err,idir,ip,kk,void
    REAL(DP)::tscale
    INTEGER,SAVE::icurrent=1
    INTEGER,SAVE::dims(4,ndims)=-1
    LOGICAL::dofft(nfftx),found
    INTEGER,PARAMETER::stdout=6
    INTEGER::offset
    INTEGER::nx_t,ny_t,nzl_t,ldx_t,ldy_t
    INTEGER::itid,mytid,ntids
    INTEGER::omp_get_thread_num,omp_get_num_threads,omp_get_max_threads
    TYPE(C_PTR),SAVE::fw_plan_2d(ndims)=C_NULL_PTR
    TYPE(C_PTR),SAVE::bw_plan_2d(ndims)=C_NULL_PTR
    TYPE(C_PTR),SAVE::fw_plan(2,ndims)=C_NULL_PTR
    TYPE(C_PTR),SAVE::bw_plan(2,ndims)=C_NULL_PTR
    INTEGER,INTENT(IN)::nx,ny,nz,ldx,ldy,ldz,howmany,isign
    COMPLEX(DP)::f(:)
    INTEGER::i,k,j,err,idir,ip
    REAL(DP)::tscale
    INTEGER,SAVE::icurrent=1
    INTEGER,SAVE::dims(3,ndims)=-1
    TYPE(C_PTR),save::fw_plan(ndims)=C_NULL_PTR
    TYPE(C_PTR),save::bw_plan(ndims)=C_NULL_PTR
    integer::nx,ny,nz,ldx,ldy,ldz,howmany,isign
    complex(DP)::f(ldx*ldy*ldz*howmany)
    integer::do_fft_z(:),do_fft_y(:)
    integer::m,incx1,incx2
    INTEGER::i,k,j,err,idir,ip,ii,jj,h,ldh
    REAL(DP)::tscale
    INTEGER,SAVE::icurrent=1
    INTEGER,SAVE::dims(3,ndims)=-1
    TYPE(C_PTR),SAVE::fw_plan(3,ndims)=C_NULL_PTR
    TYPE(C_PTR),SAVE::bw_plan(3,ndims)=C_NULL_PTR
    INTEGER,INTENT(IN)::isign
    INTEGER,INTENT(IN)::nsl,nz,ldz
    COMPLEX(DP)::c(:),cout(:)
    REAL(DP)::tscale
    INTEGER::i,err,idir,ip,void
    INTEGER,SAVE::zdims(3,ndims)=-1
    INTEGER,SAVE::icurrent=1
    LOGICAL::done
    INTEGER::tid
    INTEGER::offset,ldz_t
    INTEGER::omp_get_max_threads
    TYPE(C_PTR),SAVE::fw_planz(ndims)=C_NULL_PTR
    TYPE(C_PTR),SAVE::bw_planz(ndims)=C_NULL_PTR
    INTEGER,INTENT(IN)::isign,ldx,ldy,nx,ny,nzl
    INTEGER,OPTIONAL,INTENT(IN)::pl2ix(:)
    COMPLEX(DP)::r(:)
    INTEGER::i,k,j,err,idir,ip,kk,void
    REAL(DP)::tscale
    INTEGER,SAVE::icurrent=1
    INTEGER,SAVE::dims(4,ndims)=-1
    LOGICAL::dofft(nfftx),done
    INTEGER,PARAMETER::stdout=6
    INTEGER::offset
    INTEGER::nx_t,ny_t,nzl_t,ldx_t,ldy_t
    INTEGER::itid,mytid,ntids
    INTEGER::omp_get_thread_num,omp_get_num_threads,omp_get_max_threads
    TYPE(C_PTR),SAVE::fw_plan(2,ndims)=C_NULL_PTR
    TYPE(C_PTR),SAVE::bw_plan(2,ndims)=C_NULL_PTR
    INTEGER,INTENT(IN)::nx,ny,nz,ldx,ldy,ldz,howmany,isign
    COMPLEX(DP)::f(:)
    INTEGER::i,k,j,err,idir,ip
    REAL(DP)::tscale
    INTEGER,SAVE::icurrent=1
    INTEGER,SAVE::dims(3,ndims)=-1
    TYPE(C_PTR),save::fw_plan(ndims)=C_NULL_PTR
    TYPE(C_PTR),save::bw_plan(ndims)=C_NULL_PTR
    INTEGER,PARAMETER::stdout=6
    integer::nx,ny,nz,ldx,ldy,ldz,howmany,isign
    complex(DP)::f(ldx*ldy*ldz)
    integer::do_fft_y(:),do_fft_z(:)
    integer::m,incx1,incx2
    INTEGER::i,k,j,err,idir,ip,ii,jj
    REAL(DP)::tscale
    INTEGER,SAVE::icurrent=1
    INTEGER,SAVE::dims(3,ndims)=-1
    TYPE(C_PTR),SAVE::fw_plan(3,ndims)=C_NULL_PTR
    TYPE(C_PTR),SAVE::bw_plan(3,ndims)=C_NULL_PTR
    INTEGER,INTENT(IN)::isign
    INTEGER,INTENT(IN)::nsl,nz,ldz
    COMPLEX(DP)::c(:),cout(:)
    REAL(DP)::tscale
    INTEGER::i,err,idir,ip,void
    INTEGER,SAVE::zdims(3,ndims)=-1
    INTEGER,SAVE::icurrent=1
    LOGICAL::done
    INTEGER::tid
    INTEGER::offset,ldz_t
    INTEGER::omp_get_max_threads
    INTEGER,PARAMETER::ltabl=2*nfftx+64
    REAL(DP),SAVE::tablez(ltabl,ndims)
    REAL(DP)::work(4*nz*nsl)
    COMPLEX(DP)::DUMMY
    INTEGER,SAVE::isys=1
    INTEGER,INTENT(IN)::isign,ldx,ldy,nx,ny,nzl
    INTEGER,OPTIONAL,INTENT(IN)::pl2ix(:)
    COMPLEX(DP)::r(:)
    INTEGER::i,k,j,err,idir,ip,kk,void
    REAL(DP)::tscale
    INTEGER,SAVE::icurrent=1
    INTEGER,SAVE::dims(4,ndims)=-1
    LOGICAL::dofft(nfftx),done
    INTEGER,PARAMETER::stdout=6
    INTEGER::offset
    INTEGER::nx_t,ny_t,nzl_t,ldx_t,ldy_t
    INTEGER::itid,mytid,ntids
    INTEGER::omp_get_thread_num,omp_get_num_threads,omp_get_max_threads
    INTEGER,PARAMETER::ltabl=2*nfftx+64
    REAL(DP),SAVE::tablex(ltabl,ndims),tabley(ltabl,ndims)
    REAL(DP)::work(4*nx*ny)
    COMPLEX(DP)::XY(ldx*ny)
    COMPLEX(DP)::DUMMY
    INTEGER,SAVE::isys=1
    INTEGER,INTENT(IN)::nx,ny,nz,ldx,ldy,ldz,howmany,isign
    COMPLEX(DP)::f(:)
    INTEGER::i,k,j,err,idir,ip
    REAL(DP)::tscale
    INTEGER,SAVE::icurrent=1
    INTEGER,SAVE::dims(3,ndims)=-1
    INTEGER,PARAMETER::ltabl=60
    INTEGER,PARAMETER::lwork=195+6*nfftx
    INTEGER,SAVE::iw0(ltabl,ndims)
    INTEGER::k_off,kj_offset
    REAL(DP),SAVE::auxp(lwork,ndims)
    COMPLEX(DP),DIMENSION(:),ALLOCATABLE::cw2
    COMPLEX(DP)::f_out(size(f))
    INTEGER::nbtasks
    integer::nx,ny,nz,ldx,ldy,ldz,howmany,isign
    complex(DP)::f(ldx*ldy*ldz)
    integer::do_fft_y(:),do_fft_z(:)
    integer::m,incx1,incx2
    INTEGER::i,k,j,err,idir,ip,ii,jj
    REAL(DP)::tscale
    INTEGER,SAVE::icurrent=1
    INTEGER,SAVE::dims(3,ndims)=-1
    INTEGER,INTENT(IN)::isign
    INTEGER,INTENT(IN)::nsl,nz,ldz
    INTEGER(kind=cuda_stream_kind)::stream
    LOGICAL,INTENT(IN),optional::in_place
    COMPLEX(DP),DEVICE::c_d(:),cout_d(:)
    REAL(DP)::tscale
    INTEGER::i,err,idir,ip,void,istat
    REAL(DP),SAVE::zflops(ndims)=0.d0
    INTEGER,SAVE::zdims(3,ndims)=-1
    INTEGER,SAVE::icurrent=1
    LOGICAL::found
    LOGICAL::is_inplace
    INTEGER::tid
    INTEGER,SAVE::cufft_planz(ndims)=0
    INTEGER,PARAMETER::RANK=1
    INTEGER::FFT_DIM(RANK),DATA_DIM(RANK)
    INTEGER::STRIDE,DIST,BATCH
    INTEGER,INTENT(IN)::isign,ldx,ldy,nx,ny,nzl
    INTEGER(kind=cuda_stream_kind)::stream
    INTEGER,OPTIONAL,INTENT(IN)::pl2ix(:)
    COMPLEX(DP),DEVICE::r_d(ldx,ldy,nzl),temp_d(ldy,nzl,ldx)
    INTEGER::i,k,j,err,idir,ip,kk,void,istat
    REAL(DP)::tscale
    INTEGER,SAVE::icurrent=1
    INTEGER,SAVE::dims(6,ndims)=-1
    LOGICAL::dofft(nfftx),found
    INTEGER,PARAMETER::stdout=6
    REAL(DP),SAVE::xyflops(ndims)=0.d0
    INTEGER,SAVE::cufft_plan_2d(ndims)=0
    INTEGER,SAVE::cufft_plan_x(ndims)=0
    INTEGER,SAVE::cufft_plan_y(2,ndims)=0
    INTEGER::batch_1,batch_2
    INTEGER,PARAMETER::RANK=2
    INTEGER::FFT_DIM(RANK),DATA_DIM(RANK)
    INTEGER::STRIDE,DIST,BATCH
    INTEGER,PARAMETER::RANK=1
    INTEGER::FFT_DIM_X(RANK),DATA_DIM_X(RANK),FFT_DIM_Y(RANK),DATA_DIM_Y(RANK)
    INTEGER::STRIDE_X,STRIDE_Y,DIST_X,DIST_Y,BATCH_X,BATCH_Y1,BATCH_Y2
    INTEGER,INTENT(IN)::nx,ny,nz,ldx,ldy,ldz,howmany,isign
    COMPLEX(DP),device::f_d(:)
    INTEGER(kind=cuda_stream_kind)::stream
    INTEGER::i,k,j,err,idir,ip,istat
    REAL(DP)::tscale
    INTEGER,SAVE::icurrent=1
    INTEGER,SAVE::dims(4,ndims)=-1
    INTEGER,SAVE::cufft_plan_3d(ndims)=0
    INTEGER,PARAMETER::RANK=3
    INTEGER::FFT_DIM(RANK),DATA_DIM(RANK)
    INTEGER::STRIDE,DIST,BATCH
    INTEGER,PARAMETER::stdout=6
    integer::nx,ny,nz,ldx,ldy,ldz,howmany,isign
    complex(DP),device::f_d(ldx*ldy*ldz)
    integer::do_fft_y(:),do_fft_z(:)
    integer(kind=cuda_stream_kind)::stream
    integer::m,incx1,incx2
    INTEGER::i,k,j,err,idir,ip,ii,jj,istat
    REAL(DP)::tscale
    INTEGER,SAVE::icurrent=1
    INTEGER,SAVE::dims(3,ndims)=-1
    INTEGER,SAVE::cufft_plan_1d(3,ndims)=0
    INTEGER,PARAMETER::RANK=3
    INTEGER::FFT_DIM(RANK),HOW_MANY(RANK),DATA_DIM(RANK)
    INTEGER::STRIDE(RANK),DIST(RANK)
    INTEGER::i
    INTEGER,PARAMETER::DP=selected_real_kind(14,200)
    INTEGER,PARAMETER::ndims=3
    INTEGER::cft_b_dims(3)
    TYPE(C_PTR)::cft_b_bw_planz=C_NULL_PTR
    TYPE(C_PTR)::cft_b_bw_planx=C_NULL_PTR
    TYPE(C_PTR)::cft_b_bw_plany=C_NULL_PTR
    complex(dp)::f(:)
    real(DP)::tscale
    integer::ip,i,first_index,how_many_y
    integer,save::icurrent=1
    integer,save::dims(3,ndims)=-1
    TYPE(C_PTR),save::bw_planz(ndims)=C_NULL_PTR
    TYPE(C_PTR),save::bw_planx(ndims)=C_NULL_PTR
    TYPE(C_PTR),save::bw_plany(ndims)=C_NULL_PTR
    integer,INTENT(IN)::nx,ny,nz
    integer,INTENT(IN)::nx,ny,nz,ldx,ldy,ldz,imin2,imax2,imin3,imax3,sgn
    complex(dp)::f(:)
    INTEGER,SAVE::k,first_index,how_many_y
    INTEGER::stdout=6
    INTEGER,ALLOCATABLE::irb(:,:)
    INTEGER,ALLOCATABLE::imin2(:),imin3(:)
    INTEGER,ALLOCATABLE::imax2(:),imax3(:)
    INTEGER,ALLOCATABLE::np2(:),np3(:)
    INTEGER::nr1=0!
    INTEGER::nr2=0
    INTEGER::nr3=0!
    INTEGER::nr1x=0
    INTEGER::nr2x=0
    INTEGER::nr3x=0
    INTEGER::nnr=0
    INTEGER::mype=0
    INTEGER::comm=0
    INTEGER::nproc=1
    INTEGER::root=0
    TYPE(fft_box_descriptor)::desc
    INTEGER,INTENT(in)::nat,nproc,mype,root,comm
    TYPE(fft_box_descriptor)::desc
    TYPE(fft_box_descriptor),INTENT(INOUT)::desc
    INTEGER,INTENT(in)::nat
    INTEGER,INTENT(in)::irb(:,:)
    TYPE(fft_type_descriptor),INTENT(IN)::dfftp
    INTEGER::nr1b,nr2b,nr3b,nr1bx,nr2bx,nr3bx
    INTEGER::isa
    INTEGER::ir2,ibig2,irb2,imin2,imax2,nr2
    INTEGER::ir3,ibig3,irb3,imin3,imax3,nr3
    INTEGER::n,nx
    REAL(DP)::log2n
    integer::nr
    logical::allowed
    integer::pwr(5)
    integer::mr,i,fac,p,maxpwr
    integer::factors(5)=(/2,3,5,7,11/)
    INTEGER,INTENT(IN)::nr
    INTEGER,OPTIONAL,INTENT(IN)::np
    INTEGER::new
    INTEGER::nr1=0!
    INTEGER::nr2=0
    INTEGER::nr3=0!
    INTEGER::nr1x=0
    INTEGER::nr2x=0
    INTEGER::nr3x=0
    LOGICAL::lpara=.FALSE.
    LOGICAL::lgamma=.FALSE.
    INTEGER::root=0
    INTEGER::comm=MPI_COMM_NULL
    INTEGER::comm2=MPI_COMM_NULL
    INTEGER::comm3=MPI_COMM_NULL
    INTEGER::nproc=1
    INTEGER::nproc2=1
    INTEGER::nproc3=1
    INTEGER::mype=0
    INTEGER::mype2=0
    INTEGER::mype3=0
    INTEGER,ALLOCATABLE::iproc(:,:),iproc2(:),iproc3(:)
    INTEGER::my_nr3p=0
    INTEGER::my_nr2p=0
    INTEGER::my_i0r3p=0
    INTEGER::my_i0r2p=0
    INTEGER,ALLOCATABLE::nr3p(:)
    INTEGER,ALLOCATABLE::nr3p_offset(:)
    INTEGER,ALLOCATABLE::nr2p(:)
    INTEGER,ALLOCATABLE::nr2p_offset(:)
    INTEGER,ALLOCATABLE::nr1p(:)
    INTEGER,ALLOCATABLE::nr1w(:)
    INTEGER::nr1w_tg
    INTEGER,ALLOCATABLE::i0r3p(:)
    INTEGER,ALLOCATABLE::i0r2p(:)
    INTEGER,ALLOCATABLE::ir1p(:)
    INTEGER,ALLOCATABLE::indp(:,:)
    INTEGER,ALLOCATABLE::ir1w(:)
    INTEGER,ALLOCATABLE::indw(:,:)
    INTEGER,ALLOCATABLE::ir1w_tg(:)
    INTEGER,ALLOCATABLE::indw_tg(:)
    INTEGER::nst
    INTEGER,ALLOCATABLE::nsp(:)
    INTEGER,ALLOCATABLE::nsp_offset(:,:)
    INTEGER,ALLOCATABLE::nsw(:)
    INTEGER,ALLOCATABLE::nsw_offset(:,:)
    INTEGER,ALLOCATABLE::nsw_tg(:)
    INTEGER,ALLOCATABLE::ngl(:)
    INTEGER,ALLOCATABLE::nwl(:)
    INTEGER::ngm
    INTEGER::ngw
    INTEGER,ALLOCATABLE::iplp(:)
    INTEGER,ALLOCATABLE::iplw(:)
    INTEGER::nnp=0
    INTEGER::nnr=0
    INTEGER::nnr_tg=0
    INTEGER,ALLOCATABLE::iss(:)
    INTEGER,ALLOCATABLE::isind(:)
    INTEGER,ALLOCATABLE::ismap(:)
    INTEGER,ALLOCATABLE::nl(:)
    INTEGER,ALLOCATABLE::nlm(:)
    INTEGER,ALLOCATABLE::tg_snd(:)
    INTEGER,ALLOCATABLE::tg_rcv(:)
    INTEGER,ALLOCATABLE::tg_sdsp(:)
    INTEGER,ALLOCATABLE::tg_rdsp(:)
    LOGICAL::has_task_groups=.FALSE.
    LOGICAL::use_pencil_decomposition=.FALSE.
    CHARACTER(len=12)::rho_clock_label=''
    CHARACTER(len=12)::wave_clock_label=''
    INTEGER::grid_id
    INTEGER(kind=cuda_stream_kind),allocatable,dimension(:)::stream_scatter_yz
    INTEGER(kind=cuda_stream_kind),allocatable,dimension(:)::stream_many
    INTEGER::nstream_many=16
    INTEGER(kind=cuda_stream_kind)::a2a_comp
    INTEGER(kind=cuda_stream_kind),allocatable,dimension(:)::bstreams
    TYPE(cudaEvent),allocatable,dimension(:)::bevents
    INTEGER::batchsize=16
    INTEGER::subbatchsize=4
    INTEGER::IPC_PEER(16)
    INTEGER,ALLOCATABLE::srh(:,:)
    REAL(DP)::fft_dual=4.0d0
    INTEGER::incremental_grid_identifier=0
    TYPE(fft_type_descriptor)::desc
    REAL(DP),INTENT(IN)::at(3,3),bg(3,3)
    REAL(DP),INTENT(IN)::gcutm
    INTEGER,INTENT(IN),OPTIONAL::fft_fact(3)
    INTEGER,INTENT(IN),OPTIONAL::nyfft
    INTEGER,INTENT(in)::comm
    INTEGER::nx,ny,ierr,imany,nzfft
    INTEGER::i,nsubbatches
    INTEGER::mype,root,nproc,nproc2,nproc3,iproc,iproc2,iproc3
    INTEGER::color,key,comm2,comm3
    TYPE(fft_type_descriptor)::desc
    INTEGER::iproc,ierr,imany
    INTEGER::i,nsubbatches
    TYPE(fft_type_descriptor)::desc
    INTEGER,INTENT(in)::nst
    INTEGER,INTENT(in)::ub(3),lb(3)
    INTEGER,INTENT(in)::idx(:)
    INTEGER,INTENT(in)::in1(:)
    INTEGER,INTENT(in)::in2(:)
    INTEGER,INTENT(in)::ncp(:)
    INTEGER,INTENT(in)::ncpw(:)
    INTEGER,INTENT(in)::ngp(:)
    INTEGER,INTENT(in)::ngpw(:)
    INTEGER,INTENT(in)::st(lb(1):ub(1),lb(2):ub(2))
    INTEGER,INTENT(in)::stw(lb(1):ub(1),lb(2):ub(2))
    INTEGER::nsp(desc%nproc),nsw_tg,nr1w_tg
    INTEGER::np,nq,i,is,iss,itg,i1,i2,m1,m2,ip
    INTEGER::ncpx,nr1px,nr2px,nr3px
    INTEGER::nr1,nr2,nr3
    INTEGER::nr1x,nr2x,nr3x
    TYPE(fft_type_descriptor),INTENT(INOUT)::dfft
    TYPE(sticks_map),INTENT(INOUT)::smap
    CHARACTER(LEN=*),INTENT(IN)::pers
    LOGICAL,INTENT(IN)::lpara
    LOGICAL,INTENT(IN)::lgamma
    INTEGER,INTENT(IN)::comm
    REAL(DP),INTENT(IN)::gcut_in
    REAL(DP),INTENT(IN)::bg(3,3)
    REAL(DP),INTENT(IN)::at(3,3)
    REAL(DP),OPTIONAL,INTENT(IN)::dual_in
    INTEGER,INTENT(IN),OPTIONAL::fft_fact(3)
    INTEGER,INTENT(IN)::nyfft
    LOGICAL,OPTIONAL,INTENT(IN)::use_pd
    INTEGER,ALLOCATABLE::st(:,:)
    INTEGER,ALLOCATABLE::nstp(:)
    INTEGER,ALLOCATABLE::sstp(:)
    INTEGER::nst
    INTEGER,ALLOCATABLE::stw(:,:)
    INTEGER,ALLOCATABLE::nstpw(:)
    INTEGER,ALLOCATABLE::sstpw(:)
    INTEGER::nstw
    REAL(DP)::gcut,gkcut,dual
    INTEGER::ngm,ngw
    REAL(DP),INTENT(IN)::at(3,3),bg(3,3)
    REAL(DP),INTENT(IN)::gcutm
    INTEGER,INTENT(IN),OPTIONAL::fft_fact(3)
    TYPE(fft_type_descriptor),INTENT(INOUT)::dfft
    TYPE(fft_type_descriptor),INTENT(IN)::dfft
    INTEGER,INTENT(INOUT)::nr1,nr2,nr3
    REAL(DP),INTENT(IN)::bg(3,3),gcut
    INTEGER::i,j,k,nr,nb(3)
    REAL(DP)::gsq,g(3)
    TYPE(fft_type_descriptor),INTENT(IN)::desc
    INTEGER::fft_stick_index
    INTEGER,INTENT(IN)::i,j
    INTEGER::mc,m1,m2
    TYPE(C_PTR)::plan
    INTEGER(KIND=C_INT)::nz,i
    TYPE(C_PTR)::plan
    TYPE(C_PTR)::plan
    INTEGER(KIND=C_INT)::nx,ny,i
    TYPE(C_PTR)::plan
    TYPE(C_PTR)::plan
    INTEGER(KIND=C_INT)::nx,ny,nz,i
    TYPE(C_PTR)::plan
    TYPE(C_PTR)::plan
    INTEGER(KIND=C_INT)::nx,ny,nz,ldx,ldy
    COMPLEX(KIND=C_DOUBLE)::xy
    TYPE(C_PTR)::plan
    INTEGER(KIND=C_INT)::nx,ny,nz,ldx,ldy
    COMPLEX(KIND=C_DOUBLE)::xy
    TYPE(C_PTR)::plan
    INTEGER(KIND=C_INT)::ny,ldx
    COMPLEX(KIND=C_DOUBLE)::xy
    TYPE(C_PTR)::plan
    INTEGER(KIND=C_INT)::ldz,nzl
    COMPLEX(KIND=C_DOUBLE)::z
    TYPE(C_PTR)::plan
    INTEGER(KIND=C_INT)::ldz
    COMPLEX(KIND=C_DOUBLE)::z
    TYPE(C_PTR)::plan
    INTEGER(KIND=C_INT)::m,inc1,inc2
    COMPLEX(KIND=C_DOUBLE)::z
    TYPE(C_PTR)::plan
    INTEGER(KIND=C_INT)::m,inc1,inc2
    COMPLEX(KIND=C_DOUBLE)::z
    integer,character(len=256),integer(C_INT16_T)::version=1
    integer(C_INT16_T)::size=48!
    integer(C_INT)::category=0
    integer(C_INT)::colorType=1
    integer(C_INT)::color
    integer(C_INT)::payloadType=0
    integer(C_INT)::reserved0
    integer(C_INT64_T)::payload
    integer(C_INT)::messageType=1
    type(C_PTR)::message
    character(kind=C_CHAR,len=*)::name
    character(kind=c_char,len=*)::name
    integer,optional::id
    integer::istat
    character(kind=c_char,len=*)::name
    integer,optional::id
    integer::istat
    TYPE(fft_type_descriptor),INTENT(in)::desc
    INTEGER,INTENT(in)::nxx_,isgn
    COMPLEX(DP),INTENT(inout)::f_in(nxx_),f_aux(nxx_)
    INTEGER::nr1_temp(1)
    INTEGER,INTENT(in)::nr2px,nproc2,my_nr2p
    INTEGER,INTENT(in)::nr1p_(nproc2),indx(desc%nr1x,nproc2),iplx(desc%nr1x)
    INTEGER::ierr,me2,iproc2,ncpx
    INTEGER::i,it,j,k,kfrom,kdest,mc,m1,m3,i1,icompact,sendsize
    INTEGER::sh(desc%nproc2),rh(desc%nproc2)
    TYPE(fft_type_descriptor),INTENT(in)::desc
    INTEGER,INTENT(in)::nxx_,isgn
    COMPLEX(DP),INTENT(inout)::f_in(nxx_),f_aux(nxx_)
    INTEGER,INTENT(in)::me2_start,me2_end
    INTEGER,INTENT(in)::ncp_(desc%nproc),ir1p_(desc%nr1x),me2_iproc3_offset(desc%nproc2,desc%nproc3)
    INTEGER::ierr,me2,me3,nproc3,iproc3,ncpx,nr3px,ip
    INTEGER::i,it,k,kfrom,kdest,mc,m1,m2,i1,sendsize
    INTEGER::my_nr1p_
    INTEGER::sh(desc%nproc3),rh(desc%nproc3)
    TYPE(fft_type_descriptor),INTENT(in)::desc
    INTEGER,INTENT(in)::nxx_,isgn
    COMPLEX(DP),INTENT(inout)::f_in(nxx_),f_aux(nxx_)
    INTEGER::ierr
    TYPE(fft_type_descriptor),INTENT(in)::desc
    INTEGER,INTENT(in)::nxx_,isgn
    COMPLEX(DP),INTENT(inout)::f_in(nxx_),f_out(nxx_)
    INTEGER::ierr
    REAL(DP),INTENT(in)::f_in(:)
    REAL(DP),INTENT(inout)::f_out(:)
    TYPE(fft_type_descriptor),INTENT(IN)::dfft
    INTEGER::proc,info,offset_in,offset_aux,ir3
    INTEGER::displs(0:dfft%nproc-1),recvcount(0:dfft%nproc-1)
    REAL(DP),ALLOCATABLE::f_aux(:)
    COMPLEX(DP),INTENT(in)::f_in(:)
    COMPLEX(DP),INTENT(inout)::f_out(:)
    TYPE(fft_type_descriptor),INTENT(IN)::dfft
    COMPLEX(DP),ALLOCATABLE::f_aux(:)
    INTEGER::proc,info,offset_in,offset_aux,ir3
    INTEGER::displs(0:dfft%nproc-1),recvcount(0:dfft%nproc-1)
    REAL(DP),INTENT(in)::f_in(:)
    REAL(DP),INTENT(inout)::f_out(:)
    TYPE(fft_type_descriptor),INTENT(IN)::dfft
    REAL(DP),ALLOCATABLE::f_aux(:)
    INTEGER::proc,info,offset_in,offset_aux,ir3
    INTEGER::displs(0:dfft%nproc-1),sendcount(0:dfft%nproc-1)
    COMPLEX(DP),INTENT(in)::f_in(:)
    COMPLEX(DP),INTENT(inout)::f_out(:)
    TYPE(fft_type_descriptor),INTENT(IN)::dfft
    COMPLEX(DP),ALLOCATABLE::f_aux(:)
    INTEGER::proc,info,offset_in,offset_aux,ir3
    INTEGER::displs(0:dfft%nproc-1),sendcount(0:dfft%nproc-1)
    TYPE(fft_type_descriptor),INTENT(in)::dfftp
    COMPLEX(DP)::f_in(:),f_out(:)
    COMPLEX(DP),ALLOCATABLE::f_aux(:)
    INTEGER::proc,info,offset_in,offset_aux,ir3
    INTEGER::displs(0:dfftp%nproc-1),recvcount(0:dfftp%nproc-1)
    TYPE(fft_type_descriptor),INTENT(in)::dfftp
    INTEGER::nbnd,nbnd_proc(dfftp%nproc),start_nbnd_proc(dfftp%nproc)
    COMPLEX(DP)::f_in(dfftp%nnr,nbnd)
    COMPLEX(DP)::f_out(dfftp%nr1x*dfftp%nr2x*dfftp%nr3x,nbnd_proc(dfftp%mype+1))
    COMPLEX(DP),ALLOCATABLE::f_aux(:)
    INTEGER::proc_,proc2_,proc3_,proc,info,offset_in,offset_aux,ir3,nr2px
    INTEGER::ibnd,jbnd,iii
    INTEGER::displs(0:dfftp%nproc-1),recvcount(0:dfftp%nproc-1)
    TYPE(fft_type_descriptor),INTENT(in)::dfftp
    INTEGER::nbnd,nbnd_proc(dfftp%nproc),start_nbnd_proc(dfftp%nproc)
    COMPLEX(DP)::f_in(dfftp%nr1x*dfftp%nr2x*dfftp%nr3x,nbnd_proc(dfftp%mype+1))
    COMPLEX(DP)::f_out(dfftp%nnr)
    COMPLEX(DP),ALLOCATABLE::f_aux(:)
    INTEGER::target_ibnd
    INTEGER::proc_,proc2_,proc3_,proc,info,offset_out,offset_aux,ir3
    INTEGER::displs(0:dfftp%nproc-1),sendcount(0:dfftp%nproc-1)
    INTEGER::ibnd,jbnd
    integer::n
    integer::ia(2,n)
    integer::i,ir,j,l
    integer::iia(2)
    TYPE(fft_type_descriptor),INTENT(in)::dfft
    INTEGER,INTENT(in)::nr3x,nxx_,isgn,ncp_(:),npp_(:)
    COMPLEX(DP),INTENT(inout)::f_in(nxx_),f_aux(nxx_)
    INTEGER::k,offset,proc,ierr,me,nprocp,gproc,i,kdest,kfrom
    INTEGER::me_p,nppx,mc,j,npp,nnp,ii,it,ip,ioff,sendsiz,ncpx,ipp,nsiz
    TYPE(fft_type_descriptor),TARGET,INTENT(in)::dfft
    INTEGER,INTENT(in)::nr3x,nxx_,isgn,ncp_(:),npp_(:)
    COMPLEX(DP),DEVICE,INTENT(inout)::f_in_d(nxx_),f_aux_d(nxx_)
    COMPLEX(DP),INTENT(inout)::f_in(nxx_),f_aux(nxx_)
    INTEGER::cuf_i,cuf_j,nswip
    INTEGER::istat
    INTEGER,POINTER,DEVICE::p_ismap_d(:)
    INTEGER::srh(2*dfft%nproc)
    INTEGER::k,offset,proc,ierr,me,nprocp,gproc,gcomm,i,kdest,kfrom
    INTEGER::me_p,nppx,mc,j,npp,nnp,ii,it,ip,ioff,sendsiz,ncpx,ipp,nblk,nsiz
    INTEGER::iter,dest,sorc
    INTEGER::istatus(MPI_STATUS_SIZE)
    TYPE(fft_type_descriptor),TARGET,INTENT(in)::dfft
    INTEGER,INTENT(in)::nr3x,nxx_,isgn,ncp_(:),npp_(:)
    COMPLEX(DP),DEVICE,INTENT(inout)::f_in_d(batchsize*nxx_),f_aux_d(batchsize*nxx_)
    COMPLEX(DP),INTENT(inout)::f_in(batchsize*nxx_),f_aux(batchsize*nxx_)
    INTEGER,INTENT(IN)::batchsize
    INTEGER,INTENT(INOUT)::srh(2*dfft%nproc)
    INTEGER::cuf_i,cuf_j,nswip
    INTEGER::istat
    INTEGER,POINTER,DEVICE::p_ismap_d(:)
    INTEGER::k,offset,proc,ierr,me,nprocp,gproc,gcomm,i,kdest,kfrom
    INTEGER::me_p,nppx,mc,j,npp,nnp,nnr,ii,it,ip,ioff,sendsiz,ncpx,ipp,nblk,nsiz
    INTEGER::iter,dest,sorc
    INTEGER::istatus(MPI_STATUS_SIZE)
    TYPE(fft_type_descriptor),TARGET,INTENT(in)::dfft
    INTEGER,INTENT(in)::nr3x,nxx_,isgn,ncp_(:),npp_(:)
    COMPLEX(DP),DEVICE,INTENT(inout)::f_in_d(batchsize*nxx_),f_aux_d(batchsize*nxx_),f_aux2_d(batchsize*nxx_)
    COMPLEX(DP),INTENT(inout)::f_in(batchsize*nxx_),f_aux(batchsize*nxx_),f_aux2(batchsize*nxx_)
    INTEGER,INTENT(IN)::batchsize,batch_id
    INTEGER::istat
    INTEGER,POINTER,DEVICE::p_ismap_d(:)
    INTEGER::k,offset,proc,ierr,me,nprocp,gproc,gcomm,i,kdest,kfrom
    INTEGER::me_p,nppx,mc,j,npp,nnp,nnr,ii,it,ip,ioff,sendsiz,ncpx,ipp,nblk,nsiz
    INTEGER,ALLOCATABLE,DIMENSION(:)::offset_proc
    INTEGER::iter,dest,sorc
    INTEGER::istatus(MPI_STATUS_SIZE)
    TYPE(fft_type_descriptor),TARGET,INTENT(in)::dfft
    INTEGER,INTENT(in)::nr3x,nxx_,isgn,ncp_(:),npp_(:)
    COMPLEX(DP),DEVICE,INTENT(inout)::f_in_d(batchsize*nxx_),f_aux_d(batchsize*nxx_),f_aux2_d(batchsize*nxx_)
    COMPLEX(DP),INTENT(inout)::f_in(batchsize*nxx_),f_aux(batchsize*nxx_),f_aux2(batchsize*nxx_)
    INTEGER,INTENT(IN)::batchsize,batch_id
    INTEGER::cuf_i,cuf_j,nswip
    INTEGER::istat
    INTEGER,POINTER,DEVICE::p_ismap_d(:)
    INTEGER::k,offset,proc,ierr,me,nprocp,gproc,gcomm,i,kdest,kfrom
    INTEGER::me_p,nppx,mc,j,npp,nnp,nnr,ii,it,ip,ioff,sendsiz,ncpx,ipp,nblk,nsiz
    INTEGER::iter,dest,sorc,req_cnt
    INTEGER::istatus(MPI_STATUS_SIZE)
    TYPE(fft_type_descriptor),TARGET,INTENT(in)::dfft
    INTEGER,INTENT(in)::nr3x,nxx_,isgn,ncp_(:),npp_(:)
    COMPLEX(DP),DEVICE,INTENT(inout)::f_in_d(batchsize*nxx_),f_aux_d(batchsize*nxx_),f_aux2_d(batchsize*nxx_)
    COMPLEX(DP),INTENT(inout)::f_in(batchsize*nxx_),f_aux(batchsize*nxx_),f_aux2(batchsize*nxx_)
    INTEGER,INTENT(IN)::batchsize,batch_id

end module test
