TEST     ?=
DEPS     ?= 
LDFLAGS ?= 
CFLAGS  ?= 

SOURCES  ?= $(TEST).f90 $(DEPS)
DEPS_OBJ  = $(DEPS:.f90=.o)

.PHONY: $(TEST) run clean

$(TEST): %: %.f90 $(DEPS_OBJ)
	gfortran $(CFLAGS) $(LDFLAGS) -cpp $^ -o $@

run: test
	./$(TEST)

$(DEPS_OBJ): %.o: %.f90
	gfortran $(CFLAGS) -cpp -c $^ -o $@ -J$(shell dirname $@)

clean:
	rm -rf $(TEST) $(shell find . -name "*.o" -delete) $(shell find . -name "*.mod" -delete)
